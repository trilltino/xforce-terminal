<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-data/apis/horizon/admin-guide/upgrading" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Upgrading | Stellar Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://developers.stellar.org/img/docusaurus/dev-docs-preview.png"><meta data-rh="true" name="twitter:image" content="https://developers.stellar.org/img/docusaurus/dev-docs-preview.png"><meta data-rh="true" property="og:url" content="https://developers.stellar.org/docs/data/apis/horizon/admin-guide/upgrading"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="es"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Upgrading | Stellar Docs"><meta data-rh="true" name="description" content="Here we&#x27;ll describe the recommended steps for upgrading a Horizon 2.x installation."><meta data-rh="true" property="og:description" content="Here we&#x27;ll describe the recommended steps for upgrading a Horizon 2.x installation."><link data-rh="true" rel="icon" href="/img/docusaurus/favicon-96x96.png"><link data-rh="true" rel="canonical" href="https://developers.stellar.org/docs/data/apis/horizon/admin-guide/upgrading"><link data-rh="true" rel="alternate" href="https://developers.stellar.org/docs/data/apis/horizon/admin-guide/upgrading" hreflang="en"><link data-rh="true" rel="alternate" href="https://developers.stellar.org/es/docs/data/apis/horizon/admin-guide/upgrading" hreflang="es"><link data-rh="true" rel="alternate" href="https://developers.stellar.org/docs/data/apis/horizon/admin-guide/upgrading" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://VNSJF5AWIZ-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Horizon","item":"https://developers.stellar.org/docs/data/apis/horizon/"},{"@type":"ListItem","position":2,"name":"Admin Guide","item":"https://developers.stellar.org/docs/data/apis/horizon/admin-guide/"},{"@type":"ListItem","position":3,"name":"Upgrading","item":"https://developers.stellar.org/docs/data/apis/horizon/admin-guide/upgrading"}]}</script><link rel="alternate" type="application/rss+xml" href="/meetings/rss.xml" title="Stellar Docs RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/meetings/atom.xml" title="Stellar Docs Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-ZCT4GYX8KN"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-ZCT4GYX8KN",{anonymize_ip:!0})</script>



<link rel="search" type="application/opensearchdescription+xml" title="Stellar Docs" href="/opensearch.xml">

<script crossorigin="anonymous" src="https://js.sentry-cdn.com/efc31f19f9c54082b8d993bfb62eee57.min.js"></script>





<script>!function(e,t,a,n){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var g=t.getElementsByTagName(a)[0],m=t.createElement(a);m.async=!0,m.src="https://www.googletagmanager.com/gtm.js?id=GTM-M2JLH37",g.parentNode.insertBefore(m,g)}(window,document,"script","dataLayer")</script>
<meta name="facebook-domain-verification" content="d0o7hha86jfxvtqyxz3d9i5wtfanmy">
<link rel="preconnect" href="https://dev.visualwebsiteoptimizer.com">
<script id="vwoCode">window._vwo_code||function(){var e=814004,t=!1,n=window,i=document,o=i.querySelector("#vwoCode"),r="_vwo_"+e+"_settings",s={};try{var a=JSON.parse(localStorage.getItem("_vwo_"+e+"_config"));s=a&&"object"==typeof a?a:{}}catch(e){}var d="session"===s.stT?n.sessionStorage:n.localStorage;code={nonce:o&&o.nonce,use_existing_jquery:function(){return"undefined"!=typeof use_existing_jquery?use_existing_jquery:void 0},library_tolerance:function(){return"undefined"!=typeof library_tolerance?library_tolerance:void 0},settings_tolerance:function(){return s.sT||2e3},hide_element_style:function(){return"{"+(s.hES||"opacity:0 !important;filter:alpha(opacity=0) !important;background:none !important;transition:none !important;")+"}"},hide_element:function(){return performance.getEntriesByName("first-contentful-paint")[0]?"":"string"==typeof s.hE?s.hE:"body"},getVersion:function(){return 2.1},finish:function(n){if(!t){t=!0;var o=i.getElementById("_vis_opt_path_hides");o&&o.parentNode.removeChild(o),n&&((new Image).src="https://dev.visualwebsiteoptimizer.com/ee.gif?a="+e+n)}},finished:function(){return t},addScript:function(e){var t=i.createElement("script");t.type="text/javascript",e.src?t.src=e.src:t.text=e.text,o&&t.setAttribute("nonce",o.nonce),i.getElementsByTagName("head")[0].appendChild(t)},load:function(e,t){var o=this.getSettings(),s=i.createElement("script");if(t=t||{},o)s.textContent=o,i.getElementsByTagName("head")[0].appendChild(s),n.VWO&&!VWO.caE||(d.removeItem(r),this.load(e));else{var a=new XMLHttpRequest;a.open("GET",e,!0),a.withCredentials=!t.dSC,a.responseType=t.responseType||"text",a.onload=function(){if(t.onloadCb)return t.onloadCb(a,e);200===a.status||304===a.status?_vwo_code.addScript({text:a.responseText}):_vwo_code.finish("&e=loading_failure:"+e)},a.onerror=function(){if(t.onerrorCb)return t.onerrorCb(e);_vwo_code.finish("&e=loading_failure:"+e)},a.send()}},getSettings:function(){try{var e=d.getItem(r);if(!e)return;return e=JSON.parse(e),Date.now()>e.e?void d.removeItem(r):e.s}catch(e){return}},init:function(){if(!(i.URL.indexOf("__vwo_disable__")>-1)){var t,s=this.settings_tolerance();if(n._vwo_settings_timer=setTimeout((function(){_vwo_code.finish(),d.removeItem(r)}),s),"body"!==this.hide_element()){t=i.createElement("style");var a=this.hide_element(),c=a?a+this.hide_element_style():"",_=i.getElementsByTagName("head")[0];t.setAttribute("id","_vis_opt_path_hides"),o&&t.setAttribute("nonce",o.nonce),t.setAttribute("type","text/css"),t.styleSheet?t.styleSheet.cssText=c:t.appendChild(i.createTextNode(c)),_.appendChild(t)}else{t=i.getElementsByTagName("head")[0],(c=i.createElement("div")).style.cssText="z-index: 2147483647 !important;position: fixed !important;left: 0 !important;top: 0 !important;width: 100% !important;height: 100% !important;background: white !important;display: block !important;",c.setAttribute("id","_vis_opt_path_hides"),c.classList.add("_vis_hide_layer"),t.parentNode.insertBefore(c,t.nextSibling)}var l=window._vis_opt_url||i.URL,p="https://dev.visualwebsiteoptimizer.com/j.php?a="+e+"&u="+encodeURIComponent(l)+"&vn=2.1";-1!==n.location.search.indexOf("_vwo_xhr")?this.addScript({src:p}):this.load(p+"&x=true")}}},n._vwo_code=code,code.init()}()</script>




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.5.2/css/all.css"><link rel="stylesheet" href="/assets/css/styles.939f515d.css">
<script src="/assets/js/runtime~main.c44c8c2c.js" defer="defer"></script>
<script src="/assets/js/main.5f7bd31c.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script>








<script>"function"==typeof window.ga&&(window.ga("require","linker"),window.ga("linker:autolink",["www.stellar.org","stellar.org"]))</script>
<noscript>
          <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-M2JLH37" height="0" width="0" style="display:none;visibility:hidden"></iframe>
          </noscript><div id="__docusaurus"><link rel="preload" as="image" href="/img/docusaurus/stellar-logo.svg"><link rel="preload" as="image" href="/img/docusaurus/stellar-logo-dark.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/docusaurus/stellar-logo.svg" alt="Stellar Docs" class="themedComponent_mlkZ themedComponent--light_NVdE" width="100"><img src="/img/docusaurus/stellar-logo-dark.svg" alt="Stellar Docs" class="themedComponent_mlkZ themedComponent--dark_xIcU" width="100"></div></a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/build">Build</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/build">Overview</a></li><li class="subtitle"><hr><a href="/docs/build/smart-contracts" class="subtitle"><small>Build Smart Contracts</small></a></li><li><a class="dropdown__link" href="/docs/build/smart-contracts/overview">Introduction</a></li><li><a class="dropdown__link has-nested-items" href="/docs/build/smart-contracts/getting-started">Getting Started</a></li><li><a class="dropdown__link has-nested-items" href="/docs/build/smart-contracts/example-contracts">Example Contracts</a></li><li class="subtitle"><hr><a href="/docs/build/apps" class="subtitle"><small>Build Applications</small></a></li><li><a class="dropdown__link" href="/docs/build/apps/overview">Introduction</a></li><li><a class="dropdown__link" href="/docs/build/apps/application-design-considerations">Application Design Considerations</a></li><li><a class="dropdown__link" href="/docs/build/apps/wallet/overview">Tutorial: Wallet SDK</a></li><li><a class="dropdown__link" href="/docs/build/apps/example-application-tutorial/overview">Tutorial: Payment Application, JavaScript</a></li><li><a class="dropdown__link" href="/docs/build/apps/swift-payment-app">Tutorial: Payment Application, Swift</a></li><li><a class="dropdown__link" href="/docs/build/apps/ingest-sdk/overview">Tutorial: Network Ingestion Pipeline</a></li><li><a class="dropdown__link" href="/docs/build/apps/guestbook/overview">Tutorial: Passkey Dapp</a></li><li><a class="dropdown__link" href="/docs/build/apps/dapp-frontend">Tutorial: Dapp Frontend</a></li><li><a class="dropdown__link" href="/docs/build/apps/smart-wallets">Smart Wallets</a></li><li class="subtitle"><hr><a href="/docs/build/guides" class="subtitle"><small>How-To Guides</small></a></li><li><a class="dropdown__link" href="/docs/build/guides/auth">Contract Authorization</a></li><li><a class="dropdown__link" href="/docs/build/guides/conventions">Contract Conventions</a></li><li><a class="dropdown__link" href="/docs/build/guides/events">Contract Events</a></li><li><a class="dropdown__link" href="/docs/build/guides/storage">Contract Storage</a></li><li><a class="dropdown__link" href="/docs/build/guides/testing">Contract Testing</a></li><li><a class="dropdown__link" href="/docs/build/guides/dapps">Dapp Development</a></li><li><a class="dropdown__link" href="/docs/build/guides/fees">Fees &amp; Metering</a></li><li><a class="dropdown__link" href="/docs/build/guides/freighter">Freighter Wallet</a></li><li><a class="dropdown__link" href="/docs/build/guides/basics">Stellar Basics</a></li><li><a class="dropdown__link" href="/docs/build/guides/rpc">RPC</a></li><li><a class="dropdown__link" href="/docs/build/guides/archival">State Archival</a></li><li><a class="dropdown__link" href="/docs/build/guides/tokens">Stellar Asset Contract Tokens</a></li><li><a class="dropdown__link" href="/docs/build/guides/transactions">Transactions</a></li><li><a class="dropdown__link" href="/docs/build/guides/conversions">Type Conversions</a></li><li class=""><hr><a href="/docs/build/security-docs" class="dropdown__link has-nested-items">Security Best Practices</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/learn/fundamentals">Learn</a><ul class="dropdown__menu"><li class="subtitle"><hr><a href="/docs/learn/fundamentals" class="subtitle"><small>Core Concepts</small></a></li><li><a class="dropdown__link" href="/docs/learn/fundamentals/stellar-stack">Stellar Stack</a></li><li><a class="dropdown__link" href="/docs/learn/fundamentals/networks">Networks</a></li><li><a class="dropdown__link" href="/docs/learn/fundamentals/lumens">Lumens (XLM)</a></li><li><a class="dropdown__link" href="/docs/learn/fundamentals/stellar-consensus-protocol">Stellar Consensus Protocol (SCP)</a></li><li><a class="dropdown__link has-nested-items" href="/docs/learn/fundamentals/stellar-data-structures">Data Structures</a></li><li><a class="dropdown__link has-nested-items" href="/docs/learn/fundamentals/transactions">Operations &amp; Transactions</a></li><li><a class="dropdown__link" href="/docs/learn/fundamentals/fees-resource-limits-metering">Fees &amp; Metering</a></li><li><a class="dropdown__link" href="/docs/learn/fundamentals/stellar-ecosystem-proposals">Stellar Ecosystem Proposals (SEPs)</a></li><li><a class="dropdown__link has-nested-items" href="/docs/learn/fundamentals/contract-development">Smart Contracts</a></li><li><a class="dropdown__link has-nested-items" href="/docs/learn/fundamentals/data-format">Data Format</a></li><li><a class="dropdown__link" href="/docs/learn/fundamentals/anchors">Ramps (anchors)</a></li><li><a class="dropdown__link" href="/docs/learn/fundamentals/liquidity-on-stellar-sdex-liquidity-pools">SDEX</a></li><li class=""><hr><a href="/docs/learn/glossary" class="dropdown__link">Glossary</a></li><li><a class="dropdown__link" href="/docs/learn/migrate">Migrate from Another Chain</a></li><li><a class="dropdown__link" href="/docs/learn/interactive">Interactive Learning</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/tokens">Tokens</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/tokens">Stellar Assets &amp; Contract Tokens</a></li><li><a class="dropdown__link" href="/docs/tokens/anatomy-of-an-asset">Assets Overview</a></li><li><a class="dropdown__link" href="/docs/tokens/quickstart">Quickstart Guide</a></li><li><a class="dropdown__link" href="/docs/tokens/control-asset-access">Asset Design Considerations</a></li><li><a class="dropdown__link" href="/docs/tokens/stellar-asset-contract">Stellar Asset Contract</a></li><li><a class="dropdown__link" href="/docs/tokens/token-interface">Token Interface</a></li><li><a class="dropdown__link" href="/docs/tokens/how-to-issue-an-asset">Tutorial: Issue an Asset</a></li><li><a class="dropdown__link" href="/docs/tokens/publishing-asset-info">Publish Asset Information</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/data">Data</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/data">Overview</a></li><li class="subtitle"><hr><a href="/docs/data/analytics" class="subtitle"><small>Analytics</small></a></li><li><a class="dropdown__link" href="/docs/data/analytics/hubble">Hubble</a></li><li><a class="dropdown__link" href="/docs/data/analytics/analytics-providers">Providers</a></li><li class="subtitle"><hr><a href="/docs/data/apis" class="subtitle"><small>API</small></a></li><li><a class="dropdown__link" href="/docs/data/apis/rpc">RPC</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/data/apis/horizon">Horizon</a></li><li><a class="dropdown__link" href="/docs/data/apis/migrate-from-horizon-to-rpc">Migrate Horizon to RPC</a></li><li><a class="dropdown__link" href="/docs/data/apis/api-providers">Providers</a></li><li class="subtitle"><hr><a href="/docs/data/indexers" class="subtitle"><small>Indexers</small></a></li><li><a class="dropdown__link" href="/docs/data/indexers/build-your-own">Build Your Own</a></li><li><a class="dropdown__link" href="/docs/data/indexers/indexer-providers">Providers</a></li><li class="subtitle"><hr><a href="/docs/data/oracles" class="subtitle"><small>Oracles</small></a></li><li><a class="dropdown__link" href="/docs/data/oracles">Providers</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/tools">Tools</a><ul class="dropdown__menu"><li class="subtitle"><hr><small>Developer Tools</small></li><li><a class="dropdown__link" href="/docs/tools/sdks">SDKs</a></li><li><a class="dropdown__link" href="/docs/tools/cli">Stellar CLI</a></li><li><a class="dropdown__link" href="/docs/tools/lab">Lab</a></li><li><a class="dropdown__link" href="/docs/tools/quickstart">Quickstart</a></li><li><a class="dropdown__link" href="/docs/tools/developer-tools/openzeppelin-contracts">OpenZeppelin Contracts</a></li><li><a class="dropdown__link has-nested-items" href="/docs/tools/developer-tools">More Developer Tools</a></li><li class="subtitle"><hr><small>Ramps</small></li><li><a class="dropdown__link" href="/docs/tools/ramps/moneygram">MoneyGram Ramps</a></li><li class="subtitle"><hr><small>Infra Tools</small></li><li><a class="dropdown__link" href="/docs/tools/infra-tools/cross-chain">Cross-Chain</a></li><li class="subtitle"><hr><small>SDF Platforms</small></li><li><a class="dropdown__link" href="/platforms/anchor-platform">Anchor Platform</a></li><li><a class="dropdown__link" href="/platforms/stellar-disbursement-platform">Stellar Disbursement Platform</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/networks">Networks</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/networks">Network Configuration</a></li><li><a class="dropdown__link" href="/docs/networks/software-versions">Software Versions</a></li><li><a class="dropdown__link" href="/docs/networks/resource-limits-fees">Resource Limits &amp; Fees</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/validators">Validators</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/validators">Validators Introduction</a></li><li><a class="dropdown__link" href="/docs/validators/admin-guide">Admin Guide</a></li><li><a class="dropdown__link" href="/docs/validators/tier-1-orgs">Tier 1 Organizations</a></li></ul></div></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/docs/data/apis/horizon/admin-guide/upgrading" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="/es/docs/data/apis/horizon/admin-guide/upgrading" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="es">EspaÃ±ol</a></li></ul></div><a href="https://github.com/stellar/stellar-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/data/apis">APIs Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/data/apis/rpc">RPC</a><button aria-label="Expand sidebar category &#x27;RPC&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/data/apis/horizon">Horizon</a><button aria-label="Collapse sidebar category &#x27;Horizon&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/data/apis/horizon/admin-guide">Admin Guide</a><button aria-label="Collapse sidebar category &#x27;Admin Guide&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/data/apis/horizon/admin-guide/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/data/apis/horizon/admin-guide/prerequisites">Prerequisites</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/data/apis/horizon/admin-guide/installing">Installing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/data/apis/horizon/admin-guide/configuring">Configuring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/data/apis/horizon/admin-guide/running">Running</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/data/apis/horizon/admin-guide/ingestion">Ingestion</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/data/apis/horizon/admin-guide/monitoring">Monitoring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/data/apis/horizon/admin-guide/scaling">Scaling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/data/apis/horizon/admin-guide/upgrading">Upgrading</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/data/apis/horizon/admin-guide/ingestion-filtering">Ingestion Filtering</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/data/apis/horizon/api-reference">API Reference</a><button aria-label="Expand sidebar category &#x27;API Reference&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/data/apis/api-providers">Providers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/data/apis/migrate-from-horizon-to-rpc">Migrate from Horizon to RPC</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_xLCN"><div class="docItemContainer_jfFK"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">APIs</span></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/data/apis/horizon"><span>Horizon</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/data/apis/horizon/admin-guide"><span>Admin Guide</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Upgrading</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Upgrading</h1></header><div class="row"><div class="col col--12 markdown"><p>Here we&#x27;ll describe the recommended steps for upgrading a Horizon 2.x installation.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pre-requisites">Pre-requisites<a href="#pre-requisites" class="hash-link" aria-label="Direct link to Pre-requisites" title="Direct link to Pre-requisites">â</a></h3>
<ul>
<li>An existing Horizon deployment consisting of one or more instances of Horizon.</li>
<li>All instances are on same 2.x version to begin.</li>
<li>If <a href="/docs/data/apis/horizon/admin-guide/installing#bare-metal">bare-metal</a> install, you have shell, or command line access to each host having a Horizon installation.</li>
<li>If <a href="/docs/data/apis/horizon/admin-guide/installing#containerized">deployed direct on Docker daemon</a>, you have command line access to the host that is running the Docker daemon.</li>
<li>If <a href="/docs/data/apis/horizon/admin-guide/installing#helm-chart-installation">deployed on Kubernetes with Helm chart</a>, you have kubectl and helm command line tools on your workstation and a user login with appropriate access levels to change resources in target namespace of Horizon deployment on the cluster.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="assess-current-installation">Assess current installation<a href="#assess-current-installation" class="hash-link" aria-label="Direct link to Assess current installation" title="Direct link to Assess current installation">â</a></h3>
<ul>
<li>
<p>Identify the list of all instances of Horizon that need to be upgraded.</p>
<ul>
<li>
<p>Bare-metal installations: the list of hosts is managed by you.</p>
</li>
<li>
<p>Docker daemon deployments: the list of hosts and running containers is managed by you.</p>
</li>
<li>
<p>Kubernetes deployments: get the list of pods that are deployed from your prior Helm installation, they will have an annotation for <code>release=your_helm_horizon_installation_name</code>:</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">bash</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">kubectl get pods </span><span class="token parameter variable" style="color:#36acaa">-l</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">release</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">your_helm_horizon_installation_name </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">your_horizon_namespace</span><span class="token operator" style="color:#393A34">&gt;</span></span><br></span></code></pre></div></div></div></div></div>
</li>
</ul>
</li>
<li>
<p>Identify your current Horizon software version:</p>
<ul>
<li>Obtain command line access to the operating system of each Horizon instance:<!-- -->
<ul>
<li>Bare-metal installations, this is typically ssh on Linux or powershell on Windows.</li>
<li>Docker daemon deployments, use <code>docker exec -it &lt;containerid&gt; /bin/bash</code></li>
<li>For Kubernetes deployments, use <code>kubectl exec -it &lt;pod_name&gt; -n &lt;horizon_namespace&gt; -- /bin/bash</code></li>
</ul>
</li>
<li>On command line of each instance, run <code>stellar-horizon version</code></li>
</ul>
</li>
<li>
<p>All instances should report the same version, if not, the system may be inconsistent, use this upgrade as opportunity to establish consistency and get them all on same version.</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="determine-the-target-version-for-upgrade">Determine the target version for upgrade<a href="#determine-the-target-version-for-upgrade" class="hash-link" aria-label="Direct link to Determine the target version for upgrade" title="Direct link to Determine the target version for upgrade">â</a></h3>
<p>Now that you know your current Horizon version, visit <a href="https://github.com/stellar/go/releases" target="_blank" rel="noopener noreferrer">Horizon Releases</a> and choose the next greater version above your current version to upgrade. Follow steps <a href="https://docs.github.com/en/repositories/releasing-projects-on-github/comparing-releases" target="_blank" rel="noopener noreferrer">recommended by GitHub to compare releases</a>, click on the <code>Compare</code> dropdown of the chosen release, and then select your current release and GH will display the differences between versions, select the <code>Files changed</code> tab, and go to the <code>services/horizon/CHANGELOG.md</code>, it will highlight the new release notes for changes that have occurred between your current version and the new version you selected. Review this and look for any <code>Breaking Changes</code>, <code>State Rebuild</code> and <code>DB Schema Migration</code> sections for consideration, as the latter two will also mention expected time for the state rebuild or db migration to apply respectively.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="install-the-new-version">Install the new version<a href="#install-the-new-version" class="hash-link" aria-label="Direct link to Install the new version" title="Direct link to Install the new version">â</a></h3>
<p>Now that you have indentified the new version and are aware of the potential impacts from upgrading to new version based on release notes, such as state rebuilds and db migrations, you are informed and ready to proceed with upgrade.</p>
<p>Upgrading production deployents should leverage a secondary, hot-backup deployment, also known as a <a href="/docs/data/apis/horizon/admin-guide/scaling#scaling-to-multiple-instances">blue/green model</a> and perform the upgrade on the inactive deployment first. This will avoid downtime of system to your external users, as the upgrade takes place on the inactive deployment.</p>
<p>A good strategy for upgrading Horizon and applicable to single or multi-instance deployments - shut all instances down, install new Horizon version on one of the ingesting instances first. The reason being Horizon software will only initate <code>State Rebuild</code> and <code>DB Schema Migration</code> actions related to an upgrade on an instance that it detects ingestion has been enabled with configuration parameter, <code>INGEST=true</code>. This lowers complexity for you during the upgrade as you only need to focus on one instance and it avoids potential concurrent Horizon ingestion processes attempting the same upgrade on the database.</p>
<ul>
<li>
<p>Bare-metal installations, stop the Horizon process on all instances first, then shell into one instance that is configured for ingestion, and use apt package manager on linux.</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">bash</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> update</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> stellar-horizon</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">new_horizon_debian_pkg_version</span></span><br></span></code></pre></div></div></div></div></div>
<p>Restart Horizon using the configuration already in place, but include <code>APPLY_MIGRATIONS=true</code> environment variable, this will trigger Horizon to automatically run any db migrations that it detects are needed.</p>
</li>
<li>
<p>Docker daemon deployments, stop all docker containers first, then choose one container that has ingestion enabled, set the new tag for the image based on release published on dockerhub - <a href="https://hub.docker.com/r/stellar/stellar-horizon/tags" target="_blank" rel="noopener noreferrer">stellar/stellar-horizon</a>, and restart the container in docker daemon, include <code>APPLY_MIGRATIONS=true</code> environment variable to the container envrionment, this will trigger Horizon to automatically run any db migrations that it detects are needed.</p>
</li>
<li>
<p>For Helm installations on Kubernetes, first use your helm cli tool to stop all Horizon instances by scaling all your Horizon installations(for ingest and web) down to 0 replicas, which you&#x27;ve created prior on <a href="/docs/data/apis/horizon/admin-guide/running">run steps</a>.</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">bash</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">helm upgrade all-my-horizon-installations </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--namespace</span><span class="token plain"> my-horizon-namespace-on-cluster </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">ingest.replicaCount</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">web.replicaCount</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span></span><br></span></code></pre></div></div></div></div></div>
<p>Now, use helm to start just a single Horizon instance from a helm installation that has ingestion enabled on kubernetes cluster, you will set the <code>global.image.horizon.tag</code> to the release tag published on <a href="https://hub.docker.com/r/stellar/stellar-horizon/tags" target="_blank" rel="noopener noreferrer">stellar/stellar-horizon</a></p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">bash</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">helm upgrade my-horizon </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--namespace</span><span class="token plain"> my-horizon-namespace-on-cluster  </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">global.image.horizon.tag</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">new_horizon_release_number </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">ingest.horizonConfig.applyMigrations</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">True </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">ingest.replicaCount</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span></span><br></span></code></pre></div></div></div></div></div>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="confirming-the-upgrade-on-single-ingestion-instance-first">Confirming the upgrade on single ingestion instance first<a href="#confirming-the-upgrade-on-single-ingestion-instance-first" class="hash-link" aria-label="Direct link to Confirming the upgrade on single ingestion instance first" title="Direct link to Confirming the upgrade on single ingestion instance first">â</a></h3>
<p>If you have <a href="/docs/data/apis/horizon/admin-guide/monitoring">monitoring</a> infrastructure in place, then you have two options for assessing the upgrade status:</p>
<ul>
<li>
<p>View metrics outputs using grafana dashboards that leverage queries on the <a href="/docs/data/apis/horizon/admin-guide/monitoring#data-model">Horizon metrics data model</a> to check key stats like ingestion and network ledgers are advancing and in step.</p>
</li>
<li>
<p>View the Horizon web server &#x27;status&#x27; url path on the upgraded instance:</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">bash</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://localhost:8000/</span></span><br></span></code></pre></div></div></div></div></div>
<p>The response will be HTTP status code 200 and body of response will be a text based json data structure with diagnostic info on current Horizon software version, and ledger numbers for ingestion and network, refresh the url every 5 seconds or so, and should see the ingestion and network ledger numbers advancing and in step, indicating good connection to the network and ingestion.</p>
</li>
</ul>
<p>If metrics and/or the Horizon &#x27;status&#x27; url respones don&#x27;t indicate healthy status based on advancing ledger ingestion, two steps to triage further:</p>
<ul>
<li>A delay in Horizon achieving healthy status after an upgrade is expected and legitmate for any upgrade cases where <code>State Rebuild</code> or <code>DB Migration</code> was noted in the release delta as part of prior <a href="#determine-the-target-version-for-upgrade">Determine the target version for upgrade step</a>. Typically the notes will also mention relative timeframe expectations for those to complete which can be factored in to how long to wait on delay.</li>
<li>Check the logs from the upgraded instance to confirm what&#x27;s going on. Any <code>State Rebuild</code> or <code>DB Migration</code> initiated will be mentioned. For example, a db migration will be noted in logs with following lines for start and finish:<!-- -->
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2023/09/22 18:27:01 Applying DB migrations...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023/09/22 18:27:01 successfully applied 5 Horizon migrations</span><br></span></code></pre></div></div>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="upgrade-all-remaining-instances">Upgrade all remaining instances<a href="#upgrade-all-remaining-instances" class="hash-link" aria-label="Direct link to Upgrade all remaining instances" title="Direct link to Upgrade all remaining instances">â</a></h3>
<p>At this point, you have upgraded one ingesting instance to the new Horizon version, it has automatically updated the database if required and the instance is running with healthy status. Now, install the same Horizon software version on the remainder of instances, restarting each after the upgrade. For bare-metal and docker daemon installations that will likely be self explanatory on how to accomplish that for remainder of instances, on helm chart installations, run the helm upgrade again, setting the image tag and also restoring original <code>replicaCount</code>s:</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">bash</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">helm upgrade all-my-horizon-installations </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--namespace</span><span class="token plain"> my-horizon-namespace-on-cluster </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">ingest.replicaCount</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">web.replicaCount</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">global.image.horizon.tag</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">new_horizon_release_number </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">ingest.horizonConfig.applyMigrations</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">False</span></span><br></span></code></pre></div></div></div></div></div>
<p>For production deployments following the hot backup or blue/green model, this is the opportunity to confirm the inactive deployment has taken the upgrade correctly and stable, at which point, switch the load balancers now to forward traffic to the inactive deployment, making it the active deployment. Now, can take time to perform same upgrade on the other deployment which is now inactive.</p></div></div></div><div class="row"><div class="col col--12"><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/stellar/stellar-docs/edit/main/docs/data/apis/horizon/admin-guide/upgrading.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-09-23T18:51:32.000Z" itemprop="dateModified">Sep 23, 2025</time></b> by <b>Elliot Voris</b></span></div></div></footer></div></div></article><div class="row"><div class="col col--12"><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/data/apis/horizon/admin-guide/scaling"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Scaling</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/data/apis/horizon/admin-guide/ingestion-filtering"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Ingestion Filtering</div></a></nav></div></div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#pre-requisites" class="table-of-contents__link toc-highlight">Pre-requisites</a></li><li><a href="#assess-current-installation" class="table-of-contents__link toc-highlight">Assess current installation</a></li><li><a href="#determine-the-target-version-for-upgrade" class="table-of-contents__link toc-highlight">Determine the target version for upgrade</a></li><li><a href="#install-the-new-version" class="table-of-contents__link toc-highlight">Install the new version</a></li><li><a href="#confirming-the-upgrade-on-single-ingestion-instance-first" class="table-of-contents__link toc-highlight">Confirming the upgrade on single ingestion instance first</a></li><li><a href="#upgrade-all-remaining-instances" class="table-of-contents__link toc-highlight">Upgrade all remaining instances</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.stellar.org/developers-blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">Developer Blog<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://quest.stellar.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stellar Quest<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://fastcheapandoutofcontrol.com/tutorial" target="_blank" rel="noopener noreferrer" class="footer__link-item">Soroban Quest<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/@StellarDevelopmentFoundation" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://m.twitch.tv/stellarorg/home" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitch<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Tools</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stellar.expert" target="_blank" rel="noopener noreferrer" class="footer__link-item">Explorer<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://lab.stellar.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Lab<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://status.stellar.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Status<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://dashboard.stellar.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Dashboard<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tools">All Tools</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/stellar/stellar-docs?tab=readme-ov-file#contributing" target="_blank" rel="noopener noreferrer" class="footer__link-item">Contribute to Docs<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://discord.gg/stellardev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Developer Discord<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/meetings">Developer Meetings</a></li><li class="footer__item"><a href="https://groups.google.com/g/stellar-dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Developer Google Group<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://stellar.stackexchange.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Exchange<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://communityfund.stellar.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stellar Community Fund<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">About</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stellar.org/foundation" target="_blank" rel="noopener noreferrer" class="footer__link-item">About SDF<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://stellar.org/foundation/careers" target="_blank" rel="noopener noreferrer" class="footer__link-item">Careers<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://stellar.org/events" target="_blank" rel="noopener noreferrer" class="footer__link-item">Events<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://stellar.org/foundation/grants-and-funding" target="_blank" rel="noopener noreferrer" class="footer__link-item">Grants &amp; Funding<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div></div></footer></div>
</body>
</html>