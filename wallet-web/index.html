<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XForce Terminal - Wallet Connection</title>
    
    
    <!-- Solana Web3.js -->
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    
    <!-- Trunk will inject the compiled WASM and JS here -->
    <!-- Specify we want to build the library (WASM) - wallet_web is the library artifact name -->
    <link data-trunk rel="rust" data-target-name="wallet_web"/>
    <link data-trunk rel="css" href="style/app.css"/>
    <link data-trunk rel="copy-dir" href="assets"/>
    
    <!-- Loading screen styles - inline for immediate display -->
    <style>
        /* Prevent white flash - set body background immediately */
        body {
            margin: 0;
            padding: 0;
            background: #000000;
            color: #ffffff;
            font-family: 'JetBrains Mono', monospace;
        }
        
        html {
            background: #000000;
        }
        
        #leptos-loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            font-family: 'JetBrains Mono', monospace;
        }
        
        #leptos-loading.hidden {
            display: none;
        }
        
        .loading-spinner {
            border: 4px solid rgba(26, 0, 0, 0.3);
            border-top: 4px solid #ff0000;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin-bottom: 24px;
            box-shadow: 0 0 30px rgba(255, 0, 0, 0.5),
                        0 0 60px rgba(255, 0, 0, 0.3);
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: #ffffff;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #ffffff 0%, #ff6666 50%, #ff0000 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .loading-subtext {
            color: #888888;
            font-size: 14px;
            font-weight: 400;
        }
    </style>
    <script>
        console.log('[DEBUG] index.html script loaded');
        console.log('[DEBUG] Document ready state:', document.readyState);
        
        // Fallback: Hide loading screen when WASM loads or after timeout
        function hideLoadingScreen() {
            console.log('[DEBUG] hideLoadingScreen() called');
            const loadingElement = document.getElementById('leptos-loading');
            console.log('[DEBUG] Loading element found:', !!loadingElement);
            if (loadingElement) {
                const beforeDisplay = window.getComputedStyle(loadingElement).display;
                console.log('[DEBUG] Loading element display before:', beforeDisplay);
                console.log('[DEBUG] Loading element classes before:', loadingElement.className);
                
                loadingElement.classList.add('hidden');
                loadingElement.style.display = 'none';
                
                const afterDisplay = window.getComputedStyle(loadingElement).display;
                console.log('[DEBUG] Loading element display after:', afterDisplay);
                console.log('[DEBUG] Loading element classes after:', loadingElement.className);
                console.log('[DEBUG] Loading screen hidden via JavaScript fallback');
            } else {
                console.warn('[DEBUG] Loading element not found!');
            }
        }
        
        // Log when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                console.log('[DEBUG] DOMContentLoaded event fired');
                const loadingElement = document.getElementById('leptos-loading');
                console.log('[DEBUG] Loading element exists at DOMContentLoaded:', !!loadingElement);
            });
        } else {
            console.log('[DEBUG] DOM already loaded');
            const loadingElement = document.getElementById('leptos-loading');
            console.log('[DEBUG] Loading element exists:', !!loadingElement);
        }
        
        // Hide immediately when Trunk application starts (WASM loaded)
        window.addEventListener('TrunkApplicationStarted', function() {
            console.log('[DEBUG] TrunkApplicationStarted event fired');
            // Hide immediately, then also try after a short delay as backup
            hideLoadingScreen();
            setTimeout(function() {
                console.log('[DEBUG] TrunkApplicationStarted - 100ms timeout');
                hideLoadingScreen();
            }, 100);
            setTimeout(function() {
                console.log('[DEBUG] TrunkApplicationStarted - 500ms timeout');
                hideLoadingScreen();
            }, 500);
        });
        
        // More aggressive safety timeout: hide after 2 seconds regardless
        setTimeout(function() {
            console.log('[DEBUG] Safety timeout (2s) fired');
            hideLoadingScreen();
            console.warn('[DEBUG] Loading screen hidden via safety timeout');
        }, 2000);
        
        // Also hide after 5 seconds as final fallback
        setTimeout(function() {
            console.log('[DEBUG] Final fallback timeout (5s) fired');
            hideLoadingScreen();
        }, 5000);
        
        // Periodic check to see if loading element is still visible
        let checkCount = 0;
        const checkInterval = setInterval(function() {
            checkCount++;
            const loadingElement = document.getElementById('leptos-loading');
            if (loadingElement) {
                const display = window.getComputedStyle(loadingElement).display;
                const isVisible = display !== 'none';
                console.log(`[DEBUG] Periodic check #${checkCount}: Loading element visible=${isVisible}, display=${display}, classes=${loadingElement.className}`);
                
                if (checkCount >= 20) { // Stop after 20 checks (10 seconds)
                    clearInterval(checkInterval);
                    console.log('[DEBUG] Stopped periodic checks');
                }
            } else {
                console.log(`[DEBUG] Periodic check #${checkCount}: Loading element not found`);
                clearInterval(checkInterval);
            }
        }, 500);
    </script>
</head>
<body>
    <!-- Loading screen - shown until Leptos mounts -->
    <div id="leptos-loading">
        <div class="loading-spinner"></div>
        <div class="loading-text">XForceTerminal</div>
        <div class="loading-subtext">Loading...</div>
    </div>
    
    <!-- Leptos will mount the app here -->
</body>
</html>
