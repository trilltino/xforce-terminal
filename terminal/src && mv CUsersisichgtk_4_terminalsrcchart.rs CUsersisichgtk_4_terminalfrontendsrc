mod chart;

use gtk::prelude::*;
use gtk::{Application, ApplicationWindow, gdk};
use chart::SimpleChart;
use std::sync::Arc;

const APP_ID: &str = "com.xforce.terminal";

fn main() {
    let app = Application::builder().application_id(APP_ID).build();
    app.connect_activate(build_ui);
    app.run();
}

fn build_ui(app: &Application) {
    let window = ApplicationWindow::builder()
        .application(app)
        .title("The DeFi Trading Terminal")
        .default_width(1366)
        .default_height(768)
        .build();

    // Create chart - full window, no margins
    let chart = Arc::new(SimpleChart::new());
    let chart_widget = chart.widget().clone();

    // Demo: Add some sample XLM price data
    let sample_prices = vec![
        0.1200, 0.1215, 0.1205, 0.1220, 0.1230,
        0.1225, 0.1240, 0.1250, 0.1245, 0.1260,
        0.1255, 0.1270, 0.1265, 0.1280, 0.1275,
        0.1290, 0.1285, 0.1300, 0.1295, 0.1310,
        0.1305, 0.1320, 0.1315, 0.1330, 0.1325,
        0.1340, 0.1335, 0.1350, 0.1345, 0.1360,
    ];
    chart.update_prices(sample_prices);

    window.set_child(Some(&chart_widget));

    // Apply CSS - pure black everything, no white rectangles
    let css_provider = gtk::CssProvider::new();
    css_provider.load_from_data(
        "window {
            background-color: #000000;
            border: none;
        }
        drawingarea {
            background-color: #000000;
            border: none;
        }
        .titlebar {
            background-color: #000000;
            border: none;
        }
        headerbar {
            background-color: #000000;
            border: none;
            min-height: 0px;
        }"
    );

    if let Some(display) = gdk::Display::default() {
        gtk::style_context_add_provider_for_display(
            &display,
            &css_provider,
            gtk::STYLE_PROVIDER_PRIORITY_APPLICATION,
        );
    }

    window.present();
}
